# /etc/vault/vault.yaml
#
# Generated by Chef

userOrgUnitDn: <%= node["chub-vault"]["ldap"]["user_ou"] %>,<%= node["chub-vault"]["ldap"]["base_dn"] %>
testUsername: <%= node["chub-vault"]["ldap"]["healthcheck"]["username"] %>
testValidPassword: <%= node["chub-vault"]["ldap"]["healthcheck"]["valid_password"] %>
testInvalidPassword: <%= node["chub-vault"]["ldap"]["healthcheck"]["invalid_password"] %>
testGUID: <%= node["chub-vault"]["ldap"]["healthcheck"]["guid"] %>

ldapBind:
  host: <%= node["chub-vault"]["ldap"]["read"]["host"] %>
  ssl: true

ldapRead:
  host: <%= node["chub-vault"]["ldap"]["read"]["host"] %>
  ssl: true
  bindDn: <%= node["chub-vault"]["ldap"]["read"]["cn"] %>,<%= node["chub-vault"]["ldap"]["base_dn"] %>
  password: <%= node["chub-vault"]["ldap"]["read"]["password"] %>

ldapWrite:
  host: <%= node["chub-vault"]["ldap"]["write"]["host"] %>
  ssl: true
  bindDn: <%= node["chub-vault"]["ldap"]["write"]["cn"] %>,<%= node["chub-vault"]["ldap"]["base_dn"] %>
  password: <%= node["chub-vault"]["ldap"]["write"]["password"] %>

<% if node["chub-vault"]["database"] -%>
database:
  url: <%= node["chub-vault"]["database"]["url"] %>
  user: <%= node["chub-vault"]["database"]["user"] %>
  password: <%= node["chub-vault"]["database"]["password"] %>

<% end -%>
<% if node["graphite"] -%>
metrics:
  reporters:
    - type: hub-graphite
      <% if node["graphite"]["host"] -%>
      host: <%= node["graphite"]["host"] %>
      <% end -%>
      <% if node["graphite"]["port"] -%>
      port: <%= node["graphite"]["port"] %>
      <% end -%>
      <% if node.chef_environment != "_default" -%>
      environment: <%= node.chef_environment %>
      <% end -%>

<% end -%>
server:
  requestLog:
    appenders:
      - type: file
        currentLogFilename: /var/log/vault/vault-requests.log
        archivedLogFilenamePattern: /var/log/vault/vault-requests-%d.log.gz

logging:
  level: WARN
  loggers:
    vault: INFO
  appenders:
    - type: file
      currentLogFilename: /var/log/vault/vault.log
      archivedLogFilenamePattern: /var/log/vault/vault-%d.log.gz
