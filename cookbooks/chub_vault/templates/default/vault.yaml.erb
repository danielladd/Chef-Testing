# /etc/vault/vault.yaml
#
# Generated by Chef

archaiusConfig: /etc/vault/archaius.properties

baseDn: <%= node[:chub_vault][:ldap][:base_dn] %>
userOrgUnitDn: <%= node[:chub_vault][:ldap][:user_ou] %>,<%= node[:chub_vault][:ldap][:base_dn] %>
testUsername: <%= node[:chub_vault][:ldap][:healthcheck][:username] %>
testValidPassword: <%= node[:chub_vault][:ldap][:healthcheck][:valid_password] %>
testGUID: <%= node[:chub_vault][:ldap][:healthcheck][:guid] %>

ldapBind:
  host: <%= node[:chub_vault][:ldap][:write][:host] %>
  ssl: true

ldapRead:
  host: <%= node[:chub_vault][:ldap][:read][:host] %>
  ssl: true
  bindDn: <%= node[:chub_vault][:ldap][:read][:cn] %>,<%= node[:chub_vault][:ldap][:base_dn] %>
  password: <%= node[:chub_vault][:ldap][:read][:password] %>

ldapWrite:
  host: <%= node[:chub_vault][:ldap][:write][:host] %>
  ssl: true
  bindDn: <%= node[:chub_vault][:ldap][:write][:cn] %>,<%= node[:chub_vault][:ldap][:base_dn] %>
  password: <%= node[:chub_vault][:ldap][:write][:password] %>

<% if node[:chub_vault][:database] -%>
database:
  url: <%= node[:chub_vault][:database][:url] %>
  user: <%= node[:chub_vault][:database][:user] %>
  password: <%= node[:chub_vault][:database][:password] %>

<% end -%>
<% if node[:graphite] -%>
metrics:
  reporters:
    - type: hub-graphite
      <% if node[:graphite][:host] -%>
      host: <%= node[:graphite][:host] %>
      <% end -%>
      <% if node[:graphite][:port] -%>
      port: <%= node[:graphite][:port] %>
      <% end -%>
      <% if node.chef_environment != "_default" -%>
      environment: <%= node.chef_environment %>
      <% end -%>

<% end -%>
server:
  requestLog:
    appenders:
      - type: file
        currentLogFilename: /var/log/vault/vault-requests.log
        archivedLogFilenamePattern: /var/log/vault/vault-requests-%d.log.gz

logging:
  level: WARN
  loggers:
    vault: INFO
  appenders:
    - type: file
      currentLogFilename: /var/log/vault/vault.log
      archivedLogFilenamePattern: /var/log/vault/vault-%d.log.gz
