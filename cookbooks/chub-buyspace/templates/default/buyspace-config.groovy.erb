import groovy.time.TimeCategory

webServerUrl = "<%= node['chub-buyspace']['webServerUrl'] %>"

klerk {
    url = '<%= node['chub-buyspace']['klerk']['url'] %>'
}

sprite {
    conductorApiUrl = '<%= node['chub-buyspace']['sprite']['conductorApiUrl'] %>'
    outputContainerPrefix = '<%= node['chub-buyspace']['sprite']['outputContainerPrefix'] %>'
    imageUrlTemplate = '<%= node['chub-buyspace']['sprite']['imageUrlTemplate'] %>'
    productImageSpriteManifestWritingEnabled = '<%= node['chub-buyspace']['sprite']['productImageSpriteManifestWritingEnabled'] %>'
    pendingSpriteManifestPostingEnabled = '<%= node['chub-buyspace']['sprite']['pendingSpriteManifestPostingEnabled'] %>'
}

channelProductExporter {
    imageUrlStrategy {
        type = 'sprite'
        accessKey = '<%= node['chub-buyspace']['channelProductExporter']['imageUrlStrategy']['accessKey'] %>' 
        secretKey = '<%= node['chub-buyspace']['channelProductExporter']['imageUrlStrategy']['secretKey'] %>'
        bucketName = '<%= node['chub-buyspace']['channelProductExporter']['imageUrlStrategy']['bucketName'] %>' 
        keyTemplate = '<%= node['chub-buyspace']['channelProductExporter']['imageUrlStrategy']['keyTemplate'] %>'
        use(groovy.time.TimeCategory) {
             artifactUrlDuration = 1.day
        }
    }
}

imageUploading {
     amazon {
          accessKey = '<%= node['chub-buyspace']['imageUploading']['amazon']['accessKey'] %>'
          secretKey = '<%= node['chub-buyspace']['imageUploading']['amazon']['secretKey'] %>'
          bucket = '<%= node['chub-buyspace']['imageUploading']['amazon']['bucket'] %>'
          use(TimeCategory) {
            uploadedFileUrlDuration = 1.days
          }
     }
}

useGoogleAnalytics = <%= node['chub-buyspace']['useGoogleAnalytics'] %>

<%# TODO We probably shouldn't use the 'useGoogleAnalytics' attribute to enable/disable HubSpot integration %>
useHubSpot = <%= node['chub-buyspace']['useGoogleAnalytics'] %>

marketplace.gitRevision = System.currentTimeMillis()

<%# TODO We need to change the value of this property %>
adminEmailAddress = 'support@buyspace.com'

paymentFailureEmailAddress = 'paymentissues@buyspace.com'

<%# TODO This should be attribute-driven %>
creSecure.cardTokenValidationUrl = 'https://sandbox.cresecure.net/direct/services/validation'

marketplace.files.commerceHubRelationshipsFile = "/marketplace/rels.csv"
bestBuyMarketplace.retailerId = '51247477c519e3a71e639634'

salesforce {
    url = '<%= node['chub-buyspace']['salesforce']['url'] %>'
    apiUrl = "<%= node['chub-buyspace']['salesforce']['apiUrl'] %>"
    clientId = '<%= node['chub-buyspace']['salesforce']['clientId'] %>'
    clientSecret = '<%= node['chub-buyspace']['salesforce']['clientSecret'] %>'
    httpClient {
        connectionsPerRoute = <%= node['chub-buyspace']['salesforce']['httpClient']['connectionsPerRoute'] %>
        totalConnections = <%= node['chub-buyspace']['salesforce']['httpClient']['totalConnections'] %>
    }
    password = '<%= node['chub-buyspace']['salesforce']['password'] %>'
    tokenUrl = '<%= node['chub-buyspace']['salesforce']['tokenUrl'] %>'
    username = '<%= node['chub-buyspace']['salesforce']['username'] %>'
}

vertx {
    enabled = <%= node['chub-buyspace']['vertx']['enabled'] %>
    hazelcastConfigFile = '<%= node['chub-buyspace']['vertx']['hazelcastConfigFile'] %>'
    hostname = '<%= node['chub-buyspace']['vertx']['hostname'] %>'
    port = <%= node['chub-buyspace']['vertx']['port'] %>
}

msExchangeApi {
    <% if node.chef_environment != 'mpdev_alex' -%>
       overrideAddress = '<%= node['chub-buyspace']['msExchangeApi']['overrideAddress'] %>'
    <% end -%>
    url = "<%= node['chub-buyspace']['msExchangeApi']['url'] %>"
    credentials {
        username = '<%= node['chub-buyspace']['msExchangeApi']['credentials']['username'] %>'
        password = '<%= node['chub-buyspace']['msExchangeApi']['credentials']['password'] %>'
        domain = 'nexus'
    }
}

hornetq {
    host = '<%= node['chub-buyspace']['hornetq']['host'] %>'
    port = <%= node['chub-buyspace']['hornetq']['port'] %>
    embedded = false
}

mongo {
    databaseName = '<%= node['chub-buyspace']['mongo']['databaseName'] %>'
    replicas = <%= node['chub-buyspace']['mongo']['replicas'] %>
    <% if node.chef_environment != 'mpdev_alex' -%>
    blobStore {
        <%# TODO Consider refactoring attribute as ['chub-buyspace']['mongo']['blobstore']['databaseName'] %>
        databaseName = '<%= node['chub-buyspace']['mongo']['blobstoreDatabaseName'] %>'
        <%# TODO Consider refactoring attribute as ['chub-buyspace']['mongo']['blobstore']['replicas'] %>
        replicas = <%= node['chub-buyspace']['mongo']['blobstoreReplicas'] %>
    }
    <% end -%>
}

images {
    graphicsMagickHome = "<%= node['chub-buyspace']['images']['graphicsMagickHome'] %>"
    baseDirectory = "<%= node['chub-buyspace']['images']['baseDirectory'] %>"
    productBaseDirectory = "<%= node['chub-buyspace']['images']['productBaseDirectory'] %>"
    serverUrls = ['<%= node['chub-buyspace']['images']['serverUrls'] %>']
    datastoreDirectories = [<%= node['chub-buyspace']['images']['datastoreDirectories'] %>]
    productImageAttachmentStrategy = "<%= node['chub-buyspace']['images']['productImageAttachmentStrategy'] %>"
}

solr {
    url = '<%= node['chub-buyspace']['solr']['url'] %>'
}

grails {
  <% if node['chub-buyspace']['role']['isApi'] -%>
    serverURL = "<%= node['chub-buyspace']['grails']['apiServerURL'] %>"
  <% else -%>
    serverURL = "<%= node['chub-buyspace']['grails']['serverURL'] %>"
  <% end -%>
    apiServerURL = "<%= node['chub-buyspace']['grails']['apiServerURL'] %>"
    plugin {
        excludes = <%= node['chub-buyspace']['grails']['plugin']['excludes'] %>
    }
}

<%# TODO This should be attribute-driven as we won't be using the mock strategy in production %>
paymentStrategy = 'mock'

creSecure {
    baseFormBuilderUrl = "<%= node['chub-buyspace']['grails']['serverURL'] %>/cre/form.gsp"
}

taskScheduler.enabled = <%= node['chub-buyspace']['taskScheduler']['enabled'] %>

dateConfig {
    <%# TODO This needs to be attribute-driven as we won't be enabling dateConfig in production %>
    enabled = true
    offsetMillis = 0
}

<%# TODO This should probably be attribute-driven %>
marketplace.logUsernames = true

semantics3 {
    apiKey = "<%= node['chub-buyspace']['semantics3']['apiKey'] %>"
    apiSecret = "<%= node['chub-buyspace']['semantics3']['apiSecret'] %>"
}

log4j = {
    appenders {
        rollingFile name: 'file', maxFileSize: '5MB', file: "<%= node['chub-buyspace']['log_dir'] %>/buyspace-app.log", maxBackupIndex: 75
        'null' name: 'stacktrace'
        appender new com.ryantenney.log4j.RedisAppender(
            name: 'logstash',
            <%# TODO userFields should be attribute-driven since we're including an environment identifier (e.g. env:mpqa1, env:mpprod1) %>
            layout: new com.commercehub.logging.log4j.LogstashEventLayout(userFields: 'env:mpqa1,app:marketplace'),
            <%# TODO host should be attribute-driven %>
            host: 'mplogs01.nexus.commercehub.com',
            key: 'logstash',
            alwaysBatch: false,
            threshold: org.apache.log4j.Level.WARN)
    }

    info 'org.springframework.integration',
         'org.hornetq',
         'grails.app.controllers.marketplace.IntegrationAssistanceController',
         'grails.app.services.productstream.integration.etilize.EtilizeService',
         'grails.app.services.marketplace.SalesforceService',
         'marketplace.salesforce.http.SalesforceResponseHandler',
         'marketplace.salesforce.http.SalesforceRequest'

    error 'org.codehaus.groovy.grails.web.servlet',
          'org.codehaus.groovy.grails.web.pages',
          'org.codehaus.groovy.grails.web.sitemesh',
          'org.codehaus.groovy.grails.web.mapping.filter',
          'org.codehaus.groovy.grails.web.mapping',
          'org.codehaus.groovy.grails.commons',
          'org.codehaus.groovy.grails.plugins',
          'org.codehaus.groovy.grails.orm.hibernate',
          'org.springframework',
          'org.hibernate',
          'org.codehaus.groovy.grails.web.binding',
          'net.sf.ehcache.hibernate',
          'org.codehaus.groovy.grails.web.binding.GrailsDataBinder',
          'org.springframework.security',
          'com.mongodb',
          'com.google.code',
          'org.apache.solr',
          'grails.app.services.marketplace.digest.MapReduceService'

    root {
        <%= node['chub-buyspace']['log4j']['root_loglevel'] %> 'file'
        additivity = true
    }
}

antivirus {
    hosts = <%= node['chub-buyspace']['antivirus']['hosts'] %>
    enabled = <%= node['chub-buyspace']['antivirus']['enabled'] %>
    port = <%= node['chub-buyspace']['antivirus']['port'] %>
}

bestbuy {
    ingestor {
        <%# TODO The following may need to be attribute-driven %>
        username = 'chub.test1'
        password = 'test'
        url = 'http://54.208.33.194/ingest-service/service'
    }
}

beans {
    shiroSecurityManager {
        rememberMeManager = null
    }
}

forSaleImport {
    pendingDir = '<%= node['chub-buyspace']['forSaleImport']['pendingDir'] %>'
    inProgressDir = '<%= node['chub-buyspace']['forSaleImport']['inProgressDir'] %>'
    doneDir = '<%= node['chub-buyspace']['forSaleImport']['doneDir'] %>'
}

<%# TODO This appears to be in conflict with the 'grails' block above %>
grails.plugin.excludes = {}

<% if node.chef_environment == 'mpdev_alex' -%>
sugar {
    restUrl = "https://chub.sugarondemand.com/service/v2/rest.php"
    username = "frankpny"
    password = "f33df3aa9450daed583ce2756a5fc9f1"
    uiUrl = "https://chub.sugarondemand.com/index.php?action=DetailView&module=Accounts&record="
}
<% end -%>
